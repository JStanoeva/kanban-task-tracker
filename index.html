<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Royal Kanban Task Tracker</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js"></script>
    <style>
        /* Custom styles for drag feedback and column height */
        body {
            font-family: 'Inter', sans-serif; /* Using Inter font */
            background-color: #f3e8ff; /* Light purple background */
        }
        .kanban-column {
            min-height: 400px; /* Ensure columns have a minimum height */
            background-color: #ffffff; /* White columns */
            border-radius: 0.75rem; /* Rounded corners for columns */
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06); /* Soft shadow */
            transition: background-color 0.2s ease-in-out;
        }
        .task-card {
            cursor: grab; /* Indicate draggable */
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            background-color: #faf5ff; /* Very light purple cards */
            border-left: 4px solid #a855f7; /* Purple left border */
            border-radius: 0.5rem; /* Rounded corners for cards */
        }
        .task-card:active {
            cursor: grabbing; /* Indicate grabbing */
            transform: scale(1.03);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        .dragging {
            opacity: 0.5; /* Make dragged item semi-transparent */
        }
        .drag-over {
            background-color: #e9d5ff; /* Highlight column when dragging over */
            border: 2px dashed #a855f7; /* Dashed border */
        }
        /* Custom button style */
        .add-task-btn {
            background-color: #a855f7; /* Purple button */
            color: white;
            transition: background-color 0.3s ease;
        }
        .add-task-btn:hover {
            background-color: #9333ea; /* Darker purple on hover */
        }
        /* Rose gold accent (can be applied selectively) */
        .rose-gold-accent {
            border-color: #B76E79; /* A simple rose gold like color */
        }
        .done-column .task-card {
             border-left-color: #10b981; /* Green border for done tasks */
             background-color: #f0fdf4; /* Light green background */
        }

        /* Ensure columns stack nicely on smaller screens */
        .kanban-board {
            display: flex;
            flex-direction: column; /* Stack columns vertically by default */
            gap: 1rem; /* Space between columns */
        }
        /* Switch to horizontal layout on medium screens and up */
        @media (min-width: 768px) { /* md breakpoint */
            .kanban-board {
                flex-direction: row; /* Arrange columns horizontally */
            }
            .kanban-column {
                flex: 1; /* Make columns share space equally */
            }
        }
    </style>
</head>
<body class="p-4 md:p-8">

    <header class="text-center mb-8">
        <h1 class="text-3xl md:text-4xl font-bold text-purple-700">üëë Royal Kanban Task Tracker üßÄ</h1>
        <p class="text-purple-600 mt-2">Organize your noble quests!</p>
    </header>

    <div class="mb-8 p-4 bg-white rounded-lg shadow-md max-w-md mx-auto">
        <h2 class="text-xl font-semibold mb-3 text-purple-700">Add New Task</h2>
        <input type="text" id="newTaskInput" placeholder="Enter task description..." class="w-full p-2 border border-gray-300 rounded-md mb-3 focus:outline-none focus:ring-2 focus:ring-purple-500">
        <button id="addTaskBtn" class="w-full add-task-btn font-bold py-2 px-4 rounded-md">
            Add Task
        </button>
    </div>

    <div class="kanban-board">
        <div id="todo" class="kanban-column p-4" ondragover="allowDrop(event)" ondrop="drop(event)" ondragleave="dragLeave(event)">
            <h2 class="text-xl font-semibold mb-4 text-center text-purple-700 border-b-2 border-purple-200 pb-2">To Do üìù</h2>
            <div class="space-y-3 min-h-[50px]">
                <div id="task-1" class="task-card p-3 shadow" draggable="true" ondragstart="drag(event)">
                    Plan the Grand Cheese Festival
                </div>
            </div>
        </div>

        <div id="inprogress" class="kanban-column p-4" ondragover="allowDrop(event)" ondrop="drop(event)" ondragleave="dragLeave(event)">
            <h2 class="text-xl font-semibold mb-4 text-center text-yellow-600 border-b-2 border-yellow-200 pb-2">In Progress üèÉ‚Äç‚ôÄÔ∏èüí®</h2>
            <div class="space-y-3 min-h-[50px]">
                 <div id="task-2" class="task-card p-3 shadow rose-gold-accent" draggable="true" ondragstart="drag(event)">
                    Design new Royal Cheese Knight armor (with rose gold accents!)
                </div>
            </div>
        </div>

        <div id="done" class="kanban-column done-column p-4" ondragover="allowDrop(event)" ondrop="drop(event)" ondragleave="dragLeave(event)">
            <h2 class="text-xl font-semibold mb-4 text-center text-green-600 border-b-2 border-green-200 pb-2">Done üéâ</h2>
            <div class="space-y-3 min-h-[50px]">
                 <div id="task-3" class="task-card p-3 shadow" draggable="true" ondragstart="drag(event)">
                    Taste test the new Parmesan variety
                </div>
            </div>
        </div>
    </div>

    <script>
        let taskIdCounter = 4; // Start counter after initial tasks

        // --- Task Adding ---
        const addTaskBtn = document.getElementById('addTaskBtn');
        const newTaskInput = document.getElementById('newTaskInput');
        const todoColumn = document.getElementById('todo').querySelector('.space-y-3'); // Target the task container div

        addTaskBtn.addEventListener('click', addTask);
        newTaskInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                addTask();
            }
        });

        function addTask() {
            const taskText = newTaskInput.value.trim();
            if (taskText === '') {
                alert('Please enter a task description!'); // Simple validation
                return;
            }

            const newTask = document.createElement('div');
            newTask.id = `task-${taskIdCounter++}`;
            newTask.className = 'task-card p-3 shadow';
            newTask.draggable = true;
            newTask.textContent = taskText;
            newTask.addEventListener('dragstart', drag);

            todoColumn.appendChild(newTask); // Add to the 'To Do' column's task container
            newTaskInput.value = ''; // Clear input field
        }


        // --- Drag and Drop Functionality ---
        function allowDrop(ev) {
            ev.preventDefault(); // Necessary to allow dropping
            ev.currentTarget.classList.add('drag-over'); // Add visual feedback
        }

        function dragLeave(ev) {
             ev.currentTarget.classList.remove('drag-over'); // Remove visual feedback
        }

        function drag(ev) {
            ev.dataTransfer.setData("text/plain", ev.target.id); // Store the id of the dragged element
            ev.target.classList.add('dragging'); // Add class for visual feedback during drag
            // Use setTimeout to allow the browser to render the 'dragging' state before hiding
            setTimeout(() => {
                 // Optional: hide the original element smoothly if desired, but opacity handles it well
                 // ev.target.style.visibility = 'hidden';
            }, 0);
        }

        function drop(ev) {
            ev.preventDefault();
            const data = ev.dataTransfer.getData("text/plain");
            const draggedElement = document.getElementById(data);
            const dropTargetColumn = ev.currentTarget; // The column div
            const dropTargetTasksContainer = dropTargetColumn.querySelector('.space-y-3'); // The div holding tasks

            // Ensure we are dropping onto a valid column and not onto a task card itself directly
            if (dropTargetColumn.classList.contains('kanban-column') && draggedElement) {
                // Remove drag-over styling
                dropTargetColumn.classList.remove('drag-over');

                // Check if the task is being moved *to* the 'Done' column
                const isMovingToDone = dropTargetColumn.id === 'done' && draggedElement.parentElement.parentElement.id !== 'done';

                // Append the dragged element to the tasks container within the target column
                dropTargetTasksContainer.appendChild(draggedElement);

                // Trigger confetti if moved to 'Done'
                if (isMovingToDone) {
                    triggerConfetti();
                }
            }

             // Clean up dragging class regardless of where it was dropped
             if(draggedElement) {
                draggedElement.classList.remove('dragging');
                // Make sure the element is visible again if it was hidden
                // draggedElement.style.visibility = 'visible';
             }
        }

         // Add event listener to the document to clean up if drag ends outside a valid drop zone
         document.addEventListener('dragend', (ev) => {
            const draggedElement = document.querySelector('.dragging');
            if (draggedElement) {
                draggedElement.classList.remove('dragging');
                // draggedElement.style.visibility = 'visible'; // Ensure visibility
            }
            // Remove any lingering drag-over styles
            document.querySelectorAll('.drag-over').forEach(el => el.classList.remove('drag-over'));
         });


        // --- Confetti ---
        function triggerConfetti() {
            console.log("Confetti time!"); // Debug log
            confetti({
                particleCount: 150, // More confetti!
                spread: 90,         // Wider spread
                origin: { y: 0.6 }, // Start slightly lower
                colors: ['#a855f7', '#ec4899', '#fde047', '#ffffff', '#B76E79'] // Purple, Pink, Yellow, White, Rose Gold!
            });
        }

        // --- Initial Setup ---
        // Add dragstart listeners to initially loaded tasks
        document.querySelectorAll('.task-card').forEach(card => {
            card.addEventListener('dragstart', drag);
        });

    </script>

</body>
</html>
